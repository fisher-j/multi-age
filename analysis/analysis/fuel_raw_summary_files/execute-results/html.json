{
  "hash": "92004207981d3d6e73805d0eb94d1b61",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: Summarize raw fuel data\nformat:\n  html:\n    code-fold: true\n---\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse, warn.conflicts = FALSE)\nsource(\"./scripts/process_datasheets.r\")\nsource(\"./scripts/test_funs.r\")\n```\n:::\n\n\nBefore I convert our data to fuel loads, I would like to have at least a summary\nof the actual data that we collected in the field.\n\n\n## Load data from datasheets\n\nData in quasi-csv format, described in @sec-data-entry. I'm ommitting the medium\ndensity dispersed plot (MD), which only exists at one site.\n\nCounts data is straight forward\n\nSampling cylinder data uses a mix of NA and 0 if there was no vegetation. I'm\nmaking the height 0 if there was no vegetation. Also, if there is no vegetation,\nspecies is \"-\".\n\nI'm converting to duff/litter depth and percent litter to duff depth and litter\ndepth.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntransectid <- c(\"phase\", \"site\", \"treatment\", \"corner\", \"azi\")\n\nd <- combine_fuels_datasheets(\"../data\") |>\n  map(\\(x) filter(x, treatment != \"md\"))\n\nwarn_duplicates(d$transects, phase, site, treatment, corner, azi)\n\ncounts <- d$transect |>\n  select(all_of(transectid), slope, matches(\"(one|ten|hund)hr_count\")) |>\n  replace_na(list(slope = 0))\n\nstations <- d$transect |>\n  select(all_of(transectid), matches(\"\\\\w+[12]$\")) |>\n  pivot_longer(!all_of(transectid),\n    names_to = c(\".value\", \"station\"),\n    names_pattern = \"(\\\\w+)([12])\"\n  ) |>\n  # there was some inconsistency in whether heights were zero or blank if no veg\n  # was present, here I sort that out.\n  mutate(\n    avg_w_ht = if_else(live_woody == 0 & dead_woody == 0, 0, avg_w_ht),\n    avg_h_ht = if_else(live_herb == 0 & dead_herb == 0, 0, avg_h_ht),\n    species = tolower(str_replace(species, \"hb\", \"eh\")),\n    species = if_else(avg_w_ht == 0, \"-\", species),\n    litter_depth = duff_litter * pct_litter / 100,\n    duff_depth = duff_litter - litter_depth\n  ) |>\n  select(-c(metermark, duff_litter, pct_litter)) |>\n  relocate(fbd, .after = last_col())\n\nmost_freq_string <- function(x) names(which.max(table(x)))\n\ncwd <- d$coarse_woody\n```\n:::\n\n\nHeights and decay class observations are conditional on percent cover and\ndiameter respectively, it might make more sense to report weighted averages\nhere, but I'm not doing that.\n\nFor coarse woody debris, counts are averaged differently than diameter and decay\nclass. I'll report average diameter of *observed* particles only, and average of\ncounts at the transect level (including zeros). I need to ensure I'm making zero\ncounts explicit, as they are not in the data.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsum_funcs <- list(\n  mean = function(x) mean(x, na.rm = TRUE),\n  se = function(x) mean(x, na.rm = TRUE) / sqrt(sum(!is.na(x)))\n)\n\nstations_sum <- stations |>\n  group_by(phase, treatment) |>\n  summarise(across(c(where(is.double), -azi), sum_funcs)) |>\n  pivot_longer(-c(treatment, phase),\n    names_to = c(\"class\", \".value\"),\n    names_pattern = \"(.*)_(mean|se)\"\n  )\n\ncounts_sum <- counts |>\n  group_by(phase, treatment) |>\n  summarise(across(c(where(is.double), -azi), sum_funcs)) |>\n  pivot_longer(-c(treatment, phase),\n    names_to = c(\"class\", \".value\"),\n    names_pattern = \"(.*)_(mean|se)\"\n  )\n\n# I need to know all possible transects to know where there are zeros for coarse\n# woody\nall_transects <- d$transects |>\n  expand(nesting(phase, site, treatment, corner, azi))\n\n# Average decay and size across all measured logs, average counts for all\n# transects\ncwd_sum <- cwd |>\n  group_by(phase, treatment) |>\n  mutate(across(c(dia, decay), sum_funcs)) |>\n  group_by(phase, treatment, site, corner, azi) |>\n  summarize(count = n(), across(matches(\"_(se|mean)$\"), first)) |>\n  right_join(all_transects) |>\n  replace_na(list(count = 0)) |>\n  group_by(phase, treatment) |>\n  summarize(across(count, sum_funcs), across(matches(\"_(se|mean)$\"), first)) |>\n  pivot_longer(-c(treatment, phase),\n    names_to = c(\"class\", \".value\"),\n    names_pattern = \"(.*)_(mean|se)\"\n  )\n```\n:::\n\n\nHere is a summary of all the data we collected.\n\n\n::: {#tbl-raw-sampling-cylinders .cell tbl-cap='Raw raw summary of data collected within sampling cylinders for each treatment (n = 64). Average heights are for live and dead vegetation particles, and don\\'t represent an average height across an area. They are meant to be multiplied by percent cover, but are presented indepenently here to document our actual measurements.'}\n\n```{.r .cell-code}\n# this pivots wider and formats mean and se to print\nstations_sum |>\n  mutate(across(c(mean, se), \\(x) format(round(x, 1)))) |>\n  mutate(mean = glue::glue(\"{mean} ({se})\", .trim = FALSE), .keep = \"unused\") |>\n  pivot_wider(names_from = \"class\", values_from = \"mean\") |>\n  mutate(\n    treatment = fct_relevel(treatment, c(\"gs\", \"ld\", \"ha\", \"hd\")),\n    phase = factor(phase, levels = c(\"prepct\", \"postpct\"))\n  ) |>\n  arrange(phase, treatment) |>\n  rename(\n   \"Phase\" = phase,\n   \"Treatment\" = treatment,\n   \"Live Woody Cover (%)\" = live_woody,\n   \"Dead Woody Cover (%)\" = dead_woody,\n   \"Average Woody Height (m)\" = avg_w_ht,\n   \"Live Herb Cover (%)\" = live_herb,\n   \"Dead Herb Cover (%)\" = dead_herb,\n   \"Average Herb Height (m)\" = avg_h_ht,\n   \"Litter Depth (cm)\" = litter_depth,\n   \"Duff Depth (cm)\" = duff_depth,\n   \"Fuel Bed Depth (cm)\" = fbd\n   ) |>\n  knitr::kable(align = c(\"l\" ,\"l\" , rep(\"r\", 9)))\n```\n\n::: {.cell-output-display}\n\n\n|Phase   |Treatment | Live Woody Cover (%)| Dead Woody Cover (%)| Average Woody Height (m)| Live Herb Cover (%)| Dead Herb Cover (%)| Average Herb Height (m)| Litter Depth (cm)| Duff Depth (cm)| Fuel Bed Depth (cm)|\n|:-------|:---------|--------------------:|--------------------:|------------------------:|-------------------:|-------------------:|-----------------------:|-----------------:|---------------:|-------------------:|\n|prepct  |gs        |           38.4 (4.8)|            6.2 (0.8)|                3.5 (0.4)|           6.2 (0.8)|           1.4 (0.2)|               0.6 (0.1)|         2.8 (0.3)|       3.5 (0.4)|           8.9 (1.3)|\n|prepct  |ld        |           29.8 (3.7)|            1.9 (0.2)|                2.9 (0.4)|           8.2 (1.0)|           1.5 (0.2)|               0.3 (0.0)|         2.0 (0.2)|       3.8 (0.5)|           6.7 (1.0)|\n|prepct  |ha        |           23.2 (2.9)|            1.7 (0.2)|                2.0 (0.3)|           5.7 (0.7)|           2.1 (0.3)|               0.6 (0.1)|         2.6 (0.3)|       2.6 (0.3)|          12.5 (1.8)|\n|prepct  |hd        |           30.0 (3.8)|            1.5 (0.2)|                2.5 (0.3)|           4.5 (0.6)|           1.7 (0.2)|               0.3 (0.0)|         2.4 (0.3)|       4.7 (0.6)|           9.1 (1.3)|\n|postpct |gs        |            8.3 (1.0)|            0.7 (0.1)|                1.0 (0.1)|           5.5 (0.7)|           0.9 (0.1)|               0.2 (0.0)|        20.0 (2.5)|       2.2 (0.3)|          35.7 (4.5)|\n|postpct |ld        |           10.0 (1.3)|            0.5 (0.1)|                0.7 (0.1)|           8.0 (1.0)|           1.3 (0.2)|               0.3 (0.0)|        14.8 (1.8)|       4.3 (0.5)|          38.8 (4.9)|\n|postpct |ha        |           10.4 (1.3)|            0.8 (0.1)|                1.0 (0.1)|           7.8 (1.0)|           0.6 (0.1)|               0.3 (0.0)|         9.1 (1.1)|       1.5 (0.2)|          22.0 (2.8)|\n|postpct |hd        |           11.3 (1.4)|            0.4 (0.1)|                0.7 (0.1)|           4.3 (0.5)|           0.3 (0.0)|               0.2 (0.0)|        11.4 (1.4)|       2.2 (0.3)|          23.0 (2.9)|\n\n\n:::\n:::\n\n::: {#tbl-raw-fwd-transects .cell tbl-cap='Raw raw summary of data collected along fuel transects for each treatment (n = 32). Transect lengths for 1-hr, 10-hr, and 100-hr fuels were 1, 2, and 4 m, respectively. Redwood leaf sprays were only counted if they were ⪆2 mm.'}\n\n```{.r .cell-code}\ncounts_sum |>\n  mutate(across(c(mean, se), \\(x) format(round(x, 1)))) |>\n  mutate(mean = glue::glue(\"{mean} ({se})\", .trim = FALSE), .keep = \"unused\") |>\n  pivot_wider(names_from = \"class\", values_from = \"mean\") |>\n  mutate(\n    treatment = fct_relevel(treatment, c(\"gs\", \"ld\", \"ha\", \"hd\")),\n    phase = factor(phase, levels = c(\"prepct\", \"postpct\"))\n  ) |>\n  arrange(phase, treatment) |>\n  rename(\n   \"Phase\" = phase,\n   \"Treatment\" = treatment,\n   \"Slope\" = slope,\n   \"1-hr Count\" = onehr_count,\n   \"10-hr Count\" = tenhr_count,\n   \"100-hr Count\" = hundhr_count\n  ) |>\n  knitr::kable(align = c(\"l\", \"l\", rep(\"r\", 4)))\n```\n\n::: {.cell-output-display}\n\n\n|Phase   |Treatment |      Slope| 1-hr Count| 10-hr Count| 100-hr Count|\n|:-------|:---------|----------:|----------:|-----------:|------------:|\n|prepct  |gs        | 29.3 (5.2)| 15.5 (2.7)|   7.8 (1.4)|    4.4 (0.8)|\n|prepct  |ld        | 22.2 (3.9)| 18.2 (3.2)|   7.3 (1.3)|    3.8 (0.7)|\n|prepct  |ha        | 31.2 (5.5)| 31.5 (5.6)|   6.6 (1.2)|    3.8 (0.7)|\n|prepct  |hd        | 29.3 (5.2)| 27.8 (4.9)|   6.2 (1.1)|    3.7 (0.6)|\n|postpct |gs        | 25.9 (4.6)| 49.2 (8.7)|  19.6 (3.5)|    8.5 (1.5)|\n|postpct |ld        | 27.5 (4.9)| 48.2 (8.5)|  13.7 (2.4)|    5.9 (1.0)|\n|postpct |ha        | 29.9 (5.3)| 24.2 (4.3)|   8.2 (1.4)|    4.3 (0.8)|\n|postpct |hd        | 28.6 (5.1)| 40.5 (7.2)|   7.1 (1.2)|    2.9 (0.5)|\n\n\n:::\n:::\n\n::: {#tbl-raw-cwd-transects .cell tbl-cap='Raw raw summary of data collected for coarse woody debris (> 7.62 cm) along 10-m transects for each treatment (n = 32). Diameter and decay class are for observed particles averaged at the treatment level (48 ≤ n ≤ 84). Counts are made at the transect level and averaged at the treatment level (n = 32).'}\n\n```{.r .cell-code}\ncwd_sum |>\n  mutate(across(c(mean, se), \\(x) format(round(x, 1)))) |>\n  mutate(mean = glue::glue(\"{mean} ({se})\", .trim = FALSE), .keep = \"unused\") |>\n  pivot_wider(names_from = \"class\", values_from = \"mean\") |>\n  mutate(\n    treatment = fct_relevel(treatment, c(\"gs\", \"ld\", \"ha\", \"hd\")),\n    phase = factor(phase, levels = c(\"prepct\", \"postpct\"))\n  ) |>\n  arrange(phase, treatment) |>\n  rename(\n   \"Phase\" = phase,\n   \"Treatment\" = treatment,\n   \"Count\" = count,\n   \"Diameter (cm)\" = dia,\n   \"Decay Class\" = decay\n  ) |>\n  knitr::kable(align = c(\"l\", \"l\", rep(\"r\", 3)))\n```\n\n::: {.cell-output-display}\n\n\n|Phase   |Treatment |     Count| Diameter (cm)| Decay Class|\n|:-------|:---------|---------:|-------------:|-----------:|\n|prepct  |gs        | 2.4 (0.4)|    17.2 (2.0)|   3.7 (0.4)|\n|prepct  |ld        | 2.3 (0.4)|    15.8 (1.8)|   3.6 (0.4)|\n|prepct  |ha        | 1.7 (0.3)|    17.3 (2.3)|   3.8 (0.5)|\n|prepct  |hd        | 2.0 (0.3)|    17.9 (2.3)|   3.7 (0.5)|\n|postpct |gs        | 2.6 (0.5)|    16.8 (1.8)|   2.7 (0.3)|\n|postpct |ld        | 2.5 (0.4)|    15.4 (1.7)|   3.1 (0.4)|\n|postpct |ha        | 1.5 (0.3)|    17.3 (2.5)|   3.7 (0.5)|\n|postpct |hd        | 1.5 (0.3)|    21.4 (3.1)|   3.7 (0.5)|\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nsave(d, file = \"summarize_collected_data.rda\")\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}